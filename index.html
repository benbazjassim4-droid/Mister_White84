<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mister White Shop</title>

<style>
/* ====== STYLE ORIGINAL (INCHANG√â) ====== */
:root{
  --card: rgba(0,0,0,0.72);
  --card2: rgba(0,0,0,0.78);
  --text: #fff;
  --muted: rgba(255,255,255,0.88);
  --shadow: 0 8px 22px rgba(0,0,0,0.35);
  --radius: 14px;
  --accent1: #ff8c00;
  --accent2: #ff4500;
  --green1: #32cd32;
  --green2: #228b22;
  --danger1: #ff4d4d;
  --danger2: #b22222;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  color:white;
  background:url('background.jpg') center/cover no-repeat;
}
.safe-bottom{padding-bottom:96px}
.container{max-width:420px;margin:auto;padding:10px}
.logo{width:120px;margin:10px auto;display:block}
.screen{display:none}
.screen.active{display:block}
.categories{display:flex;gap:6px;margin:10px 0}
.categories button{
  flex:1;padding:10px;border:none;border-radius:15px;
  background:rgba(0,0,0,.6);color:white;font-weight:800;
}
.categories button.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
}
.products{display:none}
.products.active{display:block}
.product{
  background:var(--card);
  padding:10px;border-radius:12px;margin:10px 0;
}
.media img{
  width:100%;height:165px;object-fit:cover;
  border-radius:12px;cursor:pointer;
}
.add-btn{
  background:linear-gradient(135deg,var(--green1),var(--green2));
  border:none;border-radius:999px;
  padding:10px 16px;color:white;font-weight:900;
}
.cart-box{
  background:var(--card2);
  padding:12px;border-radius:14px
}
.telegram-btn{
  display:block;margin-top:10px;padding:12px;
  border-radius:12px;text-align:center;
  background:rgba(255,255,255,.12);
  color:white;font-weight:900;text-decoration:none;
}
.bottom-nav{
  position:fixed;bottom:12px;left:0;right:0;
  display:flex;justify-content:center;gap:14px
}
.nav-btn{
  width:62px;height:62px;border-radius:999px;
  background:rgba(0,0,0,.75);color:white;border:none
}
.nav-btn.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2))
}
</style>
</head>

<body class="safe-bottom">
<div class="container">
<img src="logo.jpg" class="logo">

<!-- ===== MENU ===== -->
<div id="screenMenu" class="screen active">
  <div class="categories">
    <button class="active" onclick="showCategory('usa2')">USA TopShelfüçÅüóΩ</button>
  </div>
  <div id="usa2" class="products active"></div>
</div>

<!-- ===== PANIER ===== -->
<div id="screenCart" class="screen">
  <div class="cart-box">
    <h3>üõí Panier</h3>
    <div id="cartItems">Panier vide</div>

    <input id="address" placeholder="Adresse de livraison">
    <input id="snap" placeholder="Snapchat">

    <!-- ‚úÖ BOUTON TELEGRAM -->
    <a id="tgLink" class="telegram-btn" href="#" target="_blank">
      ‚úÖ Activer le suivi Telegram (obligatoire)
    </a>

    <button id="orderBtn" onclick="sendOrder()" class="add-btn" style="width:100%;margin-top:10px">
      Passer commande
    </button>
  </div>
</div>
</div>

<!-- ===== NAV ===== -->
<div class="bottom-nav">
  <button id="btnMenu" class="nav-btn active" onclick="goMenu()">üìã</button>
  <button id="btnCart" class="nav-btn" onclick="goCart()">üõí</button>
</div>

<script>
/* ===== IDENTIFIANT CLIENT (NOUVEAU) ===== */
function getClientId(){
  let id = localStorage.getItem("mw_client_id");
  if(!id){
    id = Math.random().toString(16).slice(2)+Date.now().toString(16);
    localStorage.setItem("mw_client_id",id);
  }
  return id;
}

/* ===== TELEGRAM LINK (NOUVEAU) ===== */
const BOT_USERNAME = "misterhattest_bot"; // üî¥ √Ä MODIFIER ICI (sans @)

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("tgLink").href =
    `https://t.me/${BOT_USERNAME}?start=${getClientId()}`;
});

/* ===== PRODUIT (IDENTIQUE) ===== */
const PRODUCTS = [{
  id:"tha",
  name:"Tha Phantom (Cotton Candy X Black Mamba)",
  price:60,
  img:"asset/tha_phantom.jpg"
}];

let cart={};

/* ===== UI ===== */
function showCategory(){
  document.getElementById("usa2").innerHTML = `
    <div class="product">
      <div class="media">
        <img src="${PRODUCTS[0].img}">
      </div>
      <b>${PRODUCTS[0].name}</b><br>
      Prix : 60‚Ç¨
      <br><br>
      <button class="add-btn" onclick="addToCart()">+ 60‚Ç¨</button>
    </div>`;
}
showCategory();

function addToCart(){
  cart["tha"]={name:PRODUCTS[0].name,qty:1,price:60};
  renderCart();
}

function renderCart(){
  document.getElementById("cartItems").innerHTML =
    "- Tha Phantom x1 (60‚Ç¨)";
}

function goMenu(){
  screenMenu.classList.add("active");
  screenCart.classList.remove("active");
  btnMenu.classList.add("active");
  btnCart.classList.remove("active");
}
function goCart(){
  screenMenu.classList.remove("active");
  screenCart.classList.add("active");
  btnMenu.classList.remove("active");
  btnCart.classList.add("active");
}

/* ===== ENVOI COMMANDE (NOUVEAU) ===== */
async function sendOrder(){
  const address=document.getElementById("address").value.trim();
  if(!address){alert("Adresse manquante");return;}

  const payload={
    clientId:getClientId(),
    items:[{name:PRODUCTS[0].name,qty:1,price:60}],
    address,
    snap:document.getElementById("snap").value,
    total:60
  };

  const res=await fetch("/api/order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });
  const data=await res.json();

  if(data.ok){
    alert("Commande envoy√©e ! Tu es "+data.position+"·µâ sur la liste d‚Äôattente.");
    cart={};
    renderCart();
    goMenu();
  }else{
    alert("Erreur commande");
  }
}
</script>
</body>
</html>
