<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mister White Shop</title>

<style>
:root{
  --card: rgba(0,0,0,0.72);
  --card2: rgba(0,0,0,0.78);
  --shadow: 0 8px 22px rgba(0,0,0,0.35);
  --accent1:#ff8c00;
  --accent2:#ff4500;
  --green1:#32cd32;
  --green2:#228b22;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  color:white;
  background:url('background.jpg') center/cover no-repeat;
}
.safe-bottom{padding-bottom:96px}
.container{max-width:420px;margin:auto;padding:10px}
.logo{width:120px;margin:10px auto;display:block}
.screen{display:none}
.screen.active{display:block}
.categories{display:flex;gap:6px;margin:10px 0}
.categories button{
  flex:1;padding:10px;border:none;border-radius:15px;
  background:rgba(0,0,0,.6);color:white;font-weight:800;
}
.categories button.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
}
.products{display:none}
.products.active{display:block}
.product{
  background:var(--card);
  margin:10px 0;
  padding:10px;
  border-radius:12px;
}
.product img{
  width:100%;
  height:165px;
  object-fit:cover;
  border-radius:10px;
}
.add-btn{
  background:linear-gradient(135deg,var(--green1),var(--green2));
  border:none;border-radius:999px;
  padding:10px 16px;
  color:white;font-weight:900;
}
.cart-box{
  background:var(--card2);
  padding:12px;
  border-radius:14px;
}
.telegram-btn{
  display:block;
  margin-top:10px;
  padding:12px;
  border-radius:12px;
  text-align:center;
  background:rgba(255,255,255,.12);
  color:white;
  font-weight:900;
  text-decoration:none;
}
.bottom-nav{
  position:fixed;
  bottom:12px;
  left:0;
  right:0;
  display:flex;
  justify-content:center;
  gap:14px;
}
.nav-btn{
  width:62px;
  height:62px;
  border-radius:999px;
  background:rgba(0,0,0,.75);
  color:white;
  border:none;
}
.nav-btn.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
}
</style>
</head>

<body class="safe-bottom">
<div class="container">
<img src="logo.jpg" class="logo">

<!-- MENU -->
<div id="screenMenu" class="screen active">
  <div class="categories">
    <button id="btnCat-usa1" onclick="showCategory('usa1')">USA MiddleShelfüçÅüóΩ</button>
    <button id="btnCat-usa2" onclick="showCategory('usa2')" class="active">USA TopShelfüçÅüóΩ</button>
    <button id="btnCat-choco" onclick="showCategory('choco')">Chocolat/Mousseuxüç´</button>
    <button id="btnCat-fiesta" onclick="showCategory('fiesta')">Fiestaü•≥</button>
  </div>

  <div id="usa1" class="products"></div>
  <div id="usa2" class="products active"></div>
  <div id="choco" class="products"></div>
  <div id="fiesta" class="products"></div>
</div>

<!-- PANIER -->
<div id="screenCart" class="screen">
  <div class="cart-box">
    <h3>üõí Panier</h3>
    <div id="cartItems">Panier vide</div>

    <input id="address" placeholder="Adresse de livraison">
    <input id="snap" placeholder="Snapchat">

    <a id="tgLink" class="telegram-btn" href="#" target="_blank">
      ‚úÖ Activer le suivi Telegram (obligatoire)
    </a>

    <button id="orderBtn" class="add-btn" style="width:100%;margin-top:10px" onclick="sendOrder()">
      Passer commande
    </button>
  </div>
</div>
</div>

<!-- NAV -->
<div class="bottom-nav">
  <button id="btnMenu" class="nav-btn active" onclick="goMenu()">üìã</button>
  <button id="btnCart" class="nav-btn" onclick="goCart()">üõí</button>
</div>

<script>
/* ===== CLIENT ID ===== */
function getClientId(){
  let id = localStorage.getItem("mw_client_id");
  if(!id){
    id = Math.random().toString(16).slice(2)+Date.now().toString(16);
    localStorage.setItem("mw_client_id",id);
  }
  return id;
}

/* ===== TELEGRAM ===== */
const BOT_USERNAME = "misterhattest_bot"; // üî¥ √Ä CHANGER

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("tgLink").href =
    `https://t.me/${BOT_USERNAME}?start=${getClientId()}`;
});

/* ===== PRODUITS ===== */
const PRODUCTS = [
  {id:"a",cat:"usa1",name:"Produit A",price:0,img:""},
  {id:"tha",cat:"usa2",name:"Tha Phantom (Cotton Candy x Black Mamba)",price:60,img:"asset/tha_phantom.jpg"},
  {id:"b",cat:"usa2",name:"Bubble Gum Runtz X Candy Gas",price:0,img:""},
  {id:"c",cat:"choco",name:"Produit C",price:0,img:""},
  {id:"d",cat:"fiesta",name:"Produit D",price:0,img:""}
];

let cart={};

/* ===== UI ===== */
function showCategory(cat){
  document.querySelectorAll(".products").forEach(p=>p.classList.remove("active"));
  document.getElementById(cat).classList.add("active");
  document.querySelectorAll(".categories button").forEach(b=>b.classList.remove("active"));
  document.getElementById("btnCat-"+cat).classList.add("active");
  renderProducts(cat);
}

function renderProducts(cat){
  const el=document.getElementById(cat);
  el.innerHTML="";
  PRODUCTS.filter(p=>p.cat===cat).forEach(p=>{
    el.innerHTML+=`
      <div class="product">
        ${p.img?`<img src="${p.img}">`:""}
        <strong>${p.name}</strong><br>
        ${p.price?`Prix : ${p.price}‚Ç¨`:"Prix : √† venir"}
        <br><br>
        <button class="add-btn" onclick="addToCart('${p.id}')">
          ${p.price?"+ "+p.price+"‚Ç¨":"Bient√¥t"}
        </button>
      </div>`;
  });
}
showCategory("usa2");

function addToCart(id){
  const p=PRODUCTS.find(x=>x.id===id);
  if(!p||!p.price)return alert("Produit bient√¥t dispo");
  cart[id]={name:p.name,qty:1,price:p.price};
  renderCart();
}

function renderCart(){
  if(Object.keys(cart).length===0){
    cartItems.innerHTML="Panier vide";
    return;
  }
  cartItems.innerHTML=Object.values(cart)
    .map(i=>`- ${i.name} (${i.price}‚Ç¨)`).join("<br>");
}

function goMenu(){
  screenMenu.classList.add("active");
  screenCart.classList.remove("active");
}
function goCart(){
  screenMenu.classList.remove("active");
  screenCart.classList.add("active");
}

/* ===== COMMANDE ===== */
async function sendOrder(){
  if(Object.keys(cart).length===0)return alert("Panier vide");
  if(!address.value)return alert("Adresse manquante");

  const items=Object.values(cart);
  const total=items.reduce((s,i)=>s+i.price,0);

  const res=await fetch("/api/order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      clientId:getClientId(),
      items,
      address:address.value,
      snap:snap.value,
      total
    })
  });
  const data=await res.json();

  if(data.ok){
    alert("Commande envoy√©e ! Tu es "+data.position+"·µâ sur la liste.");
    cart={};
    renderCart();
    goMenu();
  }else alert("Erreur commande");
}
</script>
</body>
</html>
