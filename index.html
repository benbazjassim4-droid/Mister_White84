<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mister White Shop</title>

<style>
:root{
  --card: rgba(0,0,0,0.72);
  --card2: rgba(0,0,0,0.78);
  --shadow: 0 8px 22px rgba(0,0,0,0.35);
  --accent1:#ff8c00;
  --accent2:#ff4500;
  --green1:#32cd32;
  --green2:#228b22;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  color:white;
  background:url('background.jpg') center/cover no-repeat;
}
.safe-bottom{padding-bottom:96px}
.container{max-width:420px;margin:auto;padding:10px}
.logo{width:120px;margin:10px auto;display:block}

.screen{display:none}
.screen.active{display:block}

.categories{display:flex;gap:6px;margin:10px 0}
.categories button{
  flex:1;padding:10px;border:none;border-radius:15px;
  background:rgba(0,0,0,.6);color:white;font-weight:800;
}
.categories button.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
}

.products{display:none}
.products.active{display:block}

.product{
  background:var(--card);
  padding:10px;border-radius:12px;margin:10px 0;
}

.media img{
  width:100%;height:165px;object-fit:cover;
  border-radius:12px;cursor:pointer;
}

.add-btn{
  background:linear-gradient(135deg,var(--green1),var(--green2));
  border:none;border-radius:999px;
  padding:10px 16px;color:white;font-weight:900;
}

.cart-box{
  background:var(--card2);
  padding:12px;border-radius:14px
}

.telegram-btn{
  display:block;margin-top:10px;padding:12px;
  border-radius:12px;text-align:center;
  background:rgba(255,255,255,.12);
  color:white;font-weight:900;text-decoration:none;
}

.bottom-nav{
  position:fixed;bottom:12px;left:0;right:0;
  display:flex;justify-content:center;gap:14px
}
.nav-btn{
  width:62px;height:62px;border-radius:999px;
  background:rgba(0,0,0,.75);color:white;border:none
}
.nav-btn.active{
  background:linear-gradient(135deg,var(--accent1),var(--accent2))
}
</style>
</head>

<body class="safe-bottom">
<div class="container">
<img src="logo.jpg" class="logo">

<!-- ===== MENU ===== -->
<div id="screenMenu" class="screen active">
  <div class="categories">
    <button id="btn-usa1" onclick="showCategory('usa1')">USA MiddleShelfüçÅüóΩ</button>
    <button id="btn-usa2" onclick="showCategory('usa2')" class="active">USA TopShelfüçÅüóΩ</button>
    <button id="btn-choco" onclick="showCategory('choco')">Chocolat/Mousseuxüç´</button>
    <button id="btn-fiesta" onclick="showCategory('fiesta')">Fiestaü•≥</button>
  </div>

  <div id="usa1" class="products"></div>
  <div id="usa2" class="products active"></div>
  <div id="choco" class="products"></div>
  <div id="fiesta" class="products"></div>
</div>

<!-- ===== PANIER ===== -->
<div id="screenCart" class="screen">
  <div class="cart-box">
    <h3>üõí Panier</h3>
    <div id="cartItems">Panier vide</div>

    <input id="address" placeholder="Adresse de livraison">
    <input id="snap" placeholder="Snapchat">

    <a id="tgLink" class="telegram-btn" href="#" target="_blank">
      ‚úÖ Activer le suivi Telegram (obligatoire)
    </a>

    <button id="orderBtn" onclick="sendOrder()" class="add-btn" style="width:100%;margin-top:10px">
      Passer commande
    </button>
  </div>
</div>
</div>

<!-- ===== NAV ===== -->
<div class="bottom-nav">
  <button id="btnMenu" class="nav-btn active" onclick="goMenu()">üìã</button>
  <button id="btnCart" class="nav-btn" onclick="goCart()">üõí</button>
</div>

<script>
/* ===== CLIENT ID ===== */
function getClientId(){
  let id = localStorage.getItem("mw_client_id");
  if(!id){
    id = Math.random().toString(16).slice(2)+Date.now().toString(16);
    localStorage.setItem("mw_client_id",id);
  }
  return id;
}

/* ===== TELEGRAM ===== */
const BOT_USERNAME = "misterhattest_bot"; // üî¥ √Ä CHANGER

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("tgLink").href =
    `https://t.me/${BOT_USERNAME}?start=${getClientId()}`;
});

/* ===== PRODUITS ===== */
const PRODUCTS = {
  usa1:[
    {name:"Produit A",price:0}
  ],
  usa2:[
    {name:"Tha Phantom (Cotton Candy X Black Mamba)",price:60,img:"asset/tha_phantom.jpg"}
  ],
  choco:[
    {name:"Produit C",price:0}
  ],
  fiesta:[
    {name:"Produit D",price:0}
  ]
};

let cart={};

/* ===== CAT√âGORIES ===== */
function showCategory(cat){
  document.querySelectorAll(".products").forEach(p=>p.classList.remove("active"));
  document.getElementById(cat).classList.add("active");

  document.querySelectorAll(".categories button").forEach(b=>b.classList.remove("active"));
  document.getElementById("btn-"+cat).classList.add("active");

  renderProducts(cat);
}

function renderProducts(cat){
  const box=document.getElementById(cat);
  box.innerHTML="";
  PRODUCTS[cat].forEach(p=>{
    box.innerHTML+=`
      <div class="product">
        ${p.img?`<div class="media"><img src="${p.img}"></div>`:""}
        <b>${p.name}</b><br>
        ${p.price?`Prix : ${p.price}‚Ç¨`:"Prix : √† venir"}
        <br><br>
        <button class="add-btn" onclick="addToCart('${p.name}',${p.price})">
          ${p.price?"+ "+p.price+"‚Ç¨":"Bient√¥t"}
        </button>
      </div>
    `;
  });
}
showCategory("usa2");

/* ===== PANIER ===== */
function addToCart(name,price){
  if(!price) return alert("Produit bient√¥t disponible");
  cart={name,price};
  cartItems.innerHTML=`- ${name} ( ${price}‚Ç¨ )`;
}

function goMenu(){
  screenMenu.classList.add("active");
  screenCart.classList.remove("active");
}
function goCart(){
  screenMenu.classList.remove("active");
  screenCart.classList.add("active");
}

/* ===== COMMANDE ===== */
async function sendOrder(){
  if(!cart.name) return alert("Panier vide");
  if(!address.value) return alert("Adresse manquante");

  const res = await fetch("/api/order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      clientId:getClientId(),
      items:[cart],
      address:address.value,
      snap:snap.value,
      total:cart.price
    })
  });
  const data = await res.json();

  if(data.ok){
    alert("Commande envoy√©e ! Tu es "+data.position+"·µâ sur la liste.");
    cart={};
    cartItems.innerHTML="Panier vide";
    goMenu();
  }else{
    alert("Erreur commande");
  }
}
</script>
</body>
</html>
